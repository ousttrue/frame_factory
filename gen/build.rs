use std::path::Path;

fn main() {
    let cargo_dir = std::env::var("CARGO_MANIFEST_DIR").unwrap();
    let root_dir = Path::new(&cargo_dir).parent().unwrap();
    println!("{}", root_dir.to_string_lossy());
    assert!(root_dir.exists());
    let imgui_src_dir = root_dir.join("_external/imgui");
    let sdl_src_dir = root_dir.join("_external/SDL");

    // println!(
    //     "cargo:rustc-link-search=native={}/lib",
    //     imgui_dir
    // );

    cc::Build::new()
        .cpp(true)
        // .warnings(true)
        // .flag("-std=c++17")
        // .flag("-Wall")
        // .flag("-Wextra")
        // .flag("-v")
        // .flag("-g")
        // .file("src/cpp/src/hello.cpp")
        .file(imgui_src_dir.join("imgui.cpp"))
        .file(imgui_src_dir.join("imgui_widgets.cpp"))
        .file(imgui_src_dir.join("imgui_tables.cpp"))
        .file(imgui_src_dir.join("imgui_draw.cpp"))
        .file(imgui_src_dir.join("imgui_demo.cpp"))
        .file(imgui_src_dir.join("backends/imgui_impl_win32.cpp"))
        .file(imgui_src_dir.join("backends/imgui_impl_dx11.cpp"))
        .include(&imgui_src_dir)
        .file(imgui_src_dir.join("backends/imgui_impl_sdl.cpp"))
        .include(sdl_src_dir.join("include"))
        .compile("imgui_static");

    cc::Build::new()
        .include(sdl_src_dir.join("include"))
        .include(sdl_src_dir.join("src/video/khronos"))
        .define("WIN32", "1")
        .define("_WINDOWS", "1")
        .file(sdl_src_dir.join("src/SDL.c"))
        .file(sdl_src_dir.join("src/SDL_assert.c"))
        .file(sdl_src_dir.join("src/SDL_dataqueue.c"))
        .file(sdl_src_dir.join("src/SDL_error.c"))
        .file(sdl_src_dir.join("src/SDL_hints.c"))
        .file(sdl_src_dir.join("src/SDL_log.c"))
        .file(sdl_src_dir.join("src/atomic/SDL_atomic.c"))
        .file(sdl_src_dir.join("src/atomic/SDL_spinlock.c"))
        .file(sdl_src_dir.join("src/audio/SDL_audio.c"))
        .file(sdl_src_dir.join("src/audio/SDL_audiocvt.c"))
        .file(sdl_src_dir.join("src/audio/SDL_audiodev.c"))
        .file(sdl_src_dir.join("src/audio/SDL_audiotypecvt.c"))
        .file(sdl_src_dir.join("src/audio/SDL_mixer.c"))
        .file(sdl_src_dir.join("src/audio/SDL_wave.c"))
        .file(sdl_src_dir.join("src/cpuinfo/SDL_cpuinfo.c"))
        .file(sdl_src_dir.join("src/dynapi/SDL_dynapi.c"))
        .file(sdl_src_dir.join("src/events/SDL_clipboardevents.c"))
        .file(sdl_src_dir.join("src/events/SDL_displayevents.c"))
        .file(sdl_src_dir.join("src/events/SDL_dropevents.c"))
        .file(sdl_src_dir.join("src/events/SDL_events.c"))
        .file(sdl_src_dir.join("src/events/SDL_gesture.c"))
        .file(sdl_src_dir.join("src/events/SDL_keyboard.c"))
        .file(sdl_src_dir.join("src/events/SDL_mouse.c"))
        .file(sdl_src_dir.join("src/events/SDL_quit.c"))
        .file(sdl_src_dir.join("src/events/SDL_touch.c"))
        .file(sdl_src_dir.join("src/events/SDL_windowevents.c"))
        .file(sdl_src_dir.join("src/file/SDL_rwops.c"))
        .file(sdl_src_dir.join("src/haptic/SDL_haptic.c"))
        .file(sdl_src_dir.join("src/libm/e_atan2.c"))
        .file(sdl_src_dir.join("src/libm/e_exp.c"))
        .file(sdl_src_dir.join("src/libm/e_fmod.c"))
        .file(sdl_src_dir.join("src/libm/e_log.c"))
        .file(sdl_src_dir.join("src/libm/e_log10.c"))
        .file(sdl_src_dir.join("src/libm/e_pow.c"))
        .file(sdl_src_dir.join("src/libm/e_rem_pio2.c"))
        .file(sdl_src_dir.join("src/libm/e_sqrt.c"))
        .file(sdl_src_dir.join("src/libm/k_cos.c"))
        .file(sdl_src_dir.join("src/libm/k_rem_pio2.c"))
        .file(sdl_src_dir.join("src/libm/k_sin.c"))
        .file(sdl_src_dir.join("src/libm/k_tan.c"))
        .file(sdl_src_dir.join("src/libm/s_atan.c"))
        .file(sdl_src_dir.join("src/libm/s_copysign.c"))
        .file(sdl_src_dir.join("src/libm/s_cos.c"))
        .file(sdl_src_dir.join("src/libm/s_fabs.c"))
        .file(sdl_src_dir.join("src/libm/s_floor.c"))
        .file(sdl_src_dir.join("src/libm/s_scalbn.c"))
        .file(sdl_src_dir.join("src/libm/s_sin.c"))
        .file(sdl_src_dir.join("src/libm/s_tan.c"))
        .file(sdl_src_dir.join("src/locale/SDL_locale.c"))
        .file(sdl_src_dir.join("src/misc/SDL_url.c"))
        .file(sdl_src_dir.join("src/power/SDL_power.c"))
        .file(sdl_src_dir.join("src/render/SDL_d3dmath.c"))
        .file(sdl_src_dir.join("src/render/SDL_render.c"))
        .file(sdl_src_dir.join("src/render/SDL_yuv_sw.c"))
        .file(sdl_src_dir.join("src/render/direct3d/SDL_render_d3d.c"))
        .file(sdl_src_dir.join("src/render/direct3d/SDL_shaders_d3d.c"))
        .file(sdl_src_dir.join("src/render/direct3d11/SDL_render_d3d11.c"))
        .file(sdl_src_dir.join("src/render/direct3d11/SDL_shaders_d3d11.c"))
        .file(sdl_src_dir.join("src/render/opengl/SDL_render_gl.c"))
        .file(sdl_src_dir.join("src/render/opengl/SDL_shaders_gl.c"))
        .file(sdl_src_dir.join("src/render/opengles/SDL_render_gles.c"))
        .file(sdl_src_dir.join("src/render/opengles2/SDL_render_gles2.c"))
        .file(sdl_src_dir.join("src/render/opengles2/SDL_shaders_gles2.c"))
        .file(sdl_src_dir.join("src/render/psp/SDL_render_psp.c"))
        .file(sdl_src_dir.join("src/render/software/SDL_blendfillrect.c"))
        .file(sdl_src_dir.join("src/render/software/SDL_blendline.c"))
        .file(sdl_src_dir.join("src/render/software/SDL_blendpoint.c"))
        .file(sdl_src_dir.join("src/render/software/SDL_drawline.c"))
        .file(sdl_src_dir.join("src/render/software/SDL_drawpoint.c"))
        .file(sdl_src_dir.join("src/render/software/SDL_render_sw.c"))
        .file(sdl_src_dir.join("src/render/software/SDL_rotate.c"))
        .file(sdl_src_dir.join("src/render/vitagxm/SDL_render_vita_gxm.c"))
        .file(sdl_src_dir.join("src/render/vitagxm/SDL_render_vita_gxm_memory.c"))
        .file(sdl_src_dir.join("src/render/vitagxm/SDL_render_vita_gxm_tools.c"))
        .file(sdl_src_dir.join("src/sensor/SDL_sensor.c"))
        .file(sdl_src_dir.join("src/stdlib/SDL_crc32.c"))
        .file(sdl_src_dir.join("src/stdlib/SDL_getenv.c"))
        .file(sdl_src_dir.join("src/stdlib/SDL_iconv.c"))
        .file(sdl_src_dir.join("src/stdlib/SDL_malloc.c"))
        .file(sdl_src_dir.join("src/stdlib/SDL_qsort.c"))
        .file(sdl_src_dir.join("src/stdlib/SDL_stdlib.c"))
        .file(sdl_src_dir.join("src/stdlib/SDL_string.c"))
        .file(sdl_src_dir.join("src/stdlib/SDL_strtokr.c"))
        .file(sdl_src_dir.join("src/thread/SDL_thread.c"))
        .file(sdl_src_dir.join("src/timer/SDL_timer.c"))
        .file(sdl_src_dir.join("src/video/SDL_RLEaccel.c"))
        .file(sdl_src_dir.join("src/video/SDL_blit.c"))
        .file(sdl_src_dir.join("src/video/SDL_blit_0.c"))
        .file(sdl_src_dir.join("src/video/SDL_blit_1.c"))
        .file(sdl_src_dir.join("src/video/SDL_blit_A.c"))
        .file(sdl_src_dir.join("src/video/SDL_blit_N.c"))
        .file(sdl_src_dir.join("src/video/SDL_blit_auto.c"))
        .file(sdl_src_dir.join("src/video/SDL_blit_copy.c"))
        .file(sdl_src_dir.join("src/video/SDL_blit_slow.c"))
        .file(sdl_src_dir.join("src/video/SDL_bmp.c"))
        .file(sdl_src_dir.join("src/video/SDL_clipboard.c"))
        .file(sdl_src_dir.join("src/video/SDL_egl.c"))
        .file(sdl_src_dir.join("src/video/SDL_fillrect.c"))
        .file(sdl_src_dir.join("src/video/SDL_pixels.c"))
        .file(sdl_src_dir.join("src/video/SDL_rect.c"))
        .file(sdl_src_dir.join("src/video/SDL_shape.c"))
        .file(sdl_src_dir.join("src/video/SDL_stretch.c"))
        .file(sdl_src_dir.join("src/video/SDL_surface.c"))
        .file(sdl_src_dir.join("src/video/SDL_video.c"))
        .file(sdl_src_dir.join("src/video/SDL_vulkan_utils.c"))
        .file(sdl_src_dir.join("src/video/SDL_yuv.c"))
        .file(sdl_src_dir.join("src/video/yuv2rgb/yuv_rgb.c"))
        .file(sdl_src_dir.join("src/joystick/SDL_gamecontroller.c"))
        .file(sdl_src_dir.join("src/joystick/SDL_joystick.c"))
        .file(sdl_src_dir.join("src/audio/dummy/SDL_dummyaudio.c"))
        .file(sdl_src_dir.join("src/audio/disk/SDL_diskaudio.c"))
        .file(sdl_src_dir.join("src/joystick/virtual/SDL_virtualjoystick.c"))
        .file(sdl_src_dir.join("src/video/dummy/SDL_nullevents.c"))
        .file(sdl_src_dir.join("src/video/dummy/SDL_nullframebuffer.c"))
        .file(sdl_src_dir.join("src/video/dummy/SDL_nullvideo.c"))
        .file(sdl_src_dir.join("src/core/windows/SDL_hid.c"))
        .file(sdl_src_dir.join("src/core/windows/SDL_windows.c"))
        .file(sdl_src_dir.join("src/core/windows/SDL_xinput.c"))
        .file(sdl_src_dir.join("src/misc/windows/SDL_sysurl.c"))
        .file(sdl_src_dir.join("src/audio/winmm/SDL_winmm.c"))
        .file(sdl_src_dir.join("src/audio/directsound/SDL_directsound.c"))
        .file(sdl_src_dir.join("src/audio/wasapi/SDL_wasapi.c"))
        .file(sdl_src_dir.join("src/audio/wasapi/SDL_wasapi_win32.c"))
        .file(sdl_src_dir.join("src/video/windows/SDL_windowsclipboard.c"))
        .file(sdl_src_dir.join("src/video/windows/SDL_windowsevents.c"))
        .file(sdl_src_dir.join("src/video/windows/SDL_windowsframebuffer.c"))
        .file(sdl_src_dir.join("src/video/windows/SDL_windowskeyboard.c"))
        .file(sdl_src_dir.join("src/video/windows/SDL_windowsmessagebox.c"))
        .file(sdl_src_dir.join("src/video/windows/SDL_windowsmodes.c"))
        .file(sdl_src_dir.join("src/video/windows/SDL_windowsmouse.c"))
        .file(sdl_src_dir.join("src/video/windows/SDL_windowsopengl.c"))
        .file(sdl_src_dir.join("src/video/windows/SDL_windowsopengles.c"))
        .file(sdl_src_dir.join("src/video/windows/SDL_windowsshape.c"))
        .file(sdl_src_dir.join("src/video/windows/SDL_windowsvideo.c"))
        .file(sdl_src_dir.join("src/video/windows/SDL_windowsvulkan.c"))
        .file(sdl_src_dir.join("src/video/windows/SDL_windowswindow.c"))
        .file(sdl_src_dir.join("src/thread/generic/SDL_syscond.c"))
        .file(sdl_src_dir.join("src/thread/windows/SDL_syscond_srw.c"))
        .file(sdl_src_dir.join("src/thread/windows/SDL_sysmutex.c"))
        .file(sdl_src_dir.join("src/thread/windows/SDL_syssem.c"))
        .file(sdl_src_dir.join("src/thread/windows/SDL_systhread.c"))
        .file(sdl_src_dir.join("src/thread/windows/SDL_systls.c"))
        .file(sdl_src_dir.join("src/sensor/windows/SDL_windowssensor.c"))
        .file(sdl_src_dir.join("src/power/windows/SDL_syspower.c"))
        .file(sdl_src_dir.join("src/locale/windows/SDL_syslocale.c"))
        .file(sdl_src_dir.join("src/filesystem/windows/SDL_sysfilesystem.c"))
        .file(sdl_src_dir.join("src/timer/windows/SDL_systimer.c"))
        .file(sdl_src_dir.join("src/loadso/windows/SDL_sysloadso.c"))
        .file(sdl_src_dir.join("src/joystick/hidapi/SDL_hidapi_gamecube.c"))
        .file(sdl_src_dir.join("src/joystick/hidapi/SDL_hidapi_ps4.c"))
        .file(sdl_src_dir.join("src/joystick/hidapi/SDL_hidapi_ps5.c"))
        .file(sdl_src_dir.join("src/joystick/hidapi/SDL_hidapi_rumble.c"))
        .file(sdl_src_dir.join("src/joystick/hidapi/SDL_hidapi_stadia.c"))
        .file(sdl_src_dir.join("src/joystick/hidapi/SDL_hidapi_steam.c"))
        .file(sdl_src_dir.join("src/joystick/hidapi/SDL_hidapi_switch.c"))
        .file(sdl_src_dir.join("src/joystick/hidapi/SDL_hidapi_xbox360.c"))
        .file(sdl_src_dir.join("src/joystick/hidapi/SDL_hidapi_xbox360w.c"))
        .file(sdl_src_dir.join("src/joystick/hidapi/SDL_hidapi_xboxone.c"))
        .file(sdl_src_dir.join("src/joystick/hidapi/SDL_hidapijoystick.c"))
        .file(sdl_src_dir.join("src/hidapi/windows/hid.c"))
        .file(sdl_src_dir.join("src/joystick/windows/SDL_dinputjoystick.c"))
        .file(sdl_src_dir.join("src/joystick/windows/SDL_mmjoystick.c"))
        .file(sdl_src_dir.join("src/joystick/windows/SDL_rawinputjoystick.c"))
        .file(sdl_src_dir.join("src/joystick/windows/SDL_windows_gaming_input.c"))
        .file(sdl_src_dir.join("src/joystick/windows/SDL_windowsjoystick.c"))
        .file(sdl_src_dir.join("src/joystick/windows/SDL_xinputjoystick.c"))
        .file(sdl_src_dir.join("src/haptic/windows/SDL_dinputhaptic.c"))
        .file(sdl_src_dir.join("src/haptic/windows/SDL_windowshaptic.c"))
        .file(sdl_src_dir.join("src/haptic/windows/SDL_xinputhaptic.c"))
        // .file(sdl_src_dir.join("src/main/windows/version.rc"))
        .compile("SDL2");

    // SDL
    // let dst = cmake::build(format!("{}/cpp", root_dir.to_string_lossy()));
    // println!("cargo:rustc-link-search=native={}", dst.display());
    println!("cargo:rustc-link-lib=dylib=user32");
    println!("cargo:rustc-link-lib=dylib=gdi32");
    println!("cargo:rustc-link-lib=dylib=winmm");
    println!("cargo:rustc-link-lib=dylib=imm32");
    println!("cargo:rustc-link-lib=dylib=ole32");
    println!("cargo:rustc-link-lib=dylib=oleaut32");
    println!("cargo:rustc-link-lib=dylib=version");
    println!("cargo:rustc-link-lib=dylib=uuid");
    println!("cargo:rustc-link-lib=dylib=advapi32");
    println!("cargo:rustc-link-lib=dylib=setupapi");
    println!("cargo:rustc-link-lib=dylib=shell32");
    println!("cargo:rustc-link-lib=dylib=dinput8");
    println!("cargo:rustc-link-lib=dylib=kernel32");
    println!("cargo:rustc-link-lib=dylib=user32");
    println!("cargo:rustc-link-lib=dylib=gdi32");
    println!("cargo:rustc-link-lib=dylib=winspool");
    println!("cargo:rustc-link-lib=dylib=shell32");
    println!("cargo:rustc-link-lib=dylib=ole32");
    println!("cargo:rustc-link-lib=dylib=oleaut32");
    println!("cargo:rustc-link-lib=dylib=uuid");
    println!("cargo:rustc-link-lib=dylib=comdlg32");
    println!("cargo:rustc-link-lib=dylib=advapi32");
}
